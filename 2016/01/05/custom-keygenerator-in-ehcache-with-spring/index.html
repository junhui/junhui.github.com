<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="my daily technical solution and learning notes."><title>custom keygenerator in ehcache with spring | Junhuih Notes</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-71924500-1','auto');ga('send','pageview');    </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">custom keygenerator in ehcache with spring</h1><a id="logo" href="/.">Junhuih Notes</a><p class="description">Web, Solution</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">custom keygenerator in ehcache with spring</h1><div class="post-meta">2016-01-05 | <span class="categories">分类于<a href="/categories/java/"> java</a></span></div><span data-disqus-identifier="2016/01/05/custom-keygenerator-in-ehcache-with-spring/" class="disqus-comment-count"></span><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#u80CC_u666F"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u81EA_u5B9A_u4E49Cache_KeyGenerator"><span class="toc-number">2.</span> <span class="toc-text">自定义Cache KeyGenerator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4EE3_u7801_u65B9_u5F0F"><span class="toc-number">2.1.</span> <span class="toc-text">代码方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u914D_u7F6E_u65B9_u5F0F"><span class="toc-number">2.2.</span> <span class="toc-text">配置方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u5B9A_u4E49_u5355_u72EC_u7684Key_Generator_Class"><span class="toc-number">2.2.1.</span> <span class="toc-text">定义单独的Key Generator Class</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u67E5_u770B_u5F53_u524D_u7F13_u5B58_u91CC_u7684_u5185_u5BB9_uFF1A"><span class="toc-number">3.</span> <span class="toc-text">查看当前缓存里的内容：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u53C2_u8003"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u5BF9_u5E94_u7684ehcache-xml_u6587_u4EF6"><span class="toc-number">4.1.</span> <span class="toc-text">对应的ehcache.xml文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u53EF_u4EE5_u501F_u9274_u7684_u4E00_u4E9BKeyGenerator"><span class="toc-number">4.2.</span> <span class="toc-text">可以借鉴的一些KeyGenerator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u53C2_u8003_u6587_u7AE0"><span class="toc-number">4.3.</span> <span class="toc-text">参考文章</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h2><p>使用ehcache实现<code>@Cacheable</code>时，默认的缓存键(key)是采用对应方法的参数值的组合，这样，如果程序广泛使用ehcache做缓存很容易造成key的冲突，导致缓存信息错乱。</p>
<p>默认ehcache有提供三种KeyGenerator</p>
<ol>
<li>DefaultKeyGenerator</li>
<li>KeyGeneratorAdapter</li>
<li>SimpleKeyGenerator</li>
</ol>
<p>但是这三种都相对简单，下面就介绍一下怎么自定义KeyGenerator，并提供一个相对通用的方法。</p>
<h2 id="u81EA_u5B9A_u4E49Cache_KeyGenerator"><a href="#u81EA_u5B9A_u4E49Cache_KeyGenerator" class="headerlink" title="自定义Cache KeyGenerator"></a>自定义Cache KeyGenerator</h2><h3 id="u4EE3_u7801_u65B9_u5F0F"><a href="#u4EE3_u7801_u65B9_u5F0F" class="headerlink" title="代码方式"></a>代码方式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.CacheErrorHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.CacheResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Configuration</span></span><br><span class="line"><span class="annotation">@EnableCaching</span></span><br><span class="line"><span class="annotation">@ComponentScan</span>(&#123; <span class="string">"com.demo.*"</span> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> <span class="keyword">implements</span> <span class="title">CachingConfigurer</span> </span>&#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="annotation">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(ehCacheCacheManager().getObject());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title">ehCacheCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		EhCacheManagerFactoryBean cmfb = <span class="keyword">new</span> EhCacheManagerFactoryBean();</span><br><span class="line">		cmfb.setConfigLocation(<span class="keyword">new</span> ClassPathResource(<span class="string">"main/resource/ehcache.xml"</span>));</span><br><span class="line">		cmfb.setShared(<span class="keyword">true</span>);</span><br><span class="line">		<span class="keyword">return</span> cmfb;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="annotation">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> KeyGenerator <span class="title">keyGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> KeyGenerator() &#123;</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object o, Method method, Object... params)</span> </span>&#123;</span><br><span class="line">				StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">				sb.append(o.getClass().getName());</span><br><span class="line">				sb.append(<span class="string">":"</span>);</span><br><span class="line">				sb.append(method.getName());</span><br><span class="line">				sb.append(<span class="string">":"</span>);</span><br><span class="line">				<span class="keyword">for</span> (Object param : params) &#123;</span><br><span class="line">					sb.append(<span class="string">"|"</span>);</span><br><span class="line">					sb.append(param.toString());</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> sb.toString();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CacheResolver <span class="title">cacheResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CacheErrorHandler <span class="title">errorHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u914D_u7F6E_u65B9_u5F0F"><a href="#u914D_u7F6E_u65B9_u5F0F" class="headerlink" title="配置方式"></a>配置方式</h3><h4 id="u5B9A_u4E49_u5355_u72EC_u7684Key_Generator_Class"><a href="#u5B9A_u4E49_u5355_u72EC_u7684Key_Generator_Class" class="headerlink" title="定义单独的Key Generator Class"></a>定义单独的Key Generator Class</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.interceptor.KeyGenerator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnhancedDefaultKeyGenerator</span> <span class="keyword">implements</span> <span class="title">KeyGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object o, Method method, Object... params)</span> </span>&#123;</span><br><span class="line">		StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		sb.append(o.getClass().getName());</span><br><span class="line">		sb.append(<span class="string">":"</span>);</span><br><span class="line">		sb.append(method.getName());</span><br><span class="line">		sb.append(<span class="string">":"</span>);</span><br><span class="line">		<span class="keyword">for</span> (Object param : params) &#123;</span><br><span class="line">			sb.append(<span class="string">"|"</span>);</span><br><span class="line">			sb.append(param.toString());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应spring的完整配置文件如下：<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">beans</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">	<span class="attribute">xmlns:mvc</span>=<span class="value">"http://www.springframework.org/schema/mvc"</span> </span><br><span class="line">	<span class="attribute">xmlns:context</span>=<span class="value">"http://www.springframework.org/schema/context"</span></span><br><span class="line">	<span class="attribute">xmlns:cache</span>=<span class="value">"http://www.springframework.org/schema/cache"</span> </span><br><span class="line">	<span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">	<span class="attribute">xmlns:p</span>=<span class="value">"http://www.springframework.org/schema/p"</span></span><br><span class="line">	<span class="attribute">xsi:schemaLocation</span>=<span class="value">"</span><br><span class="line">        http://www.springframework.org/schema/beans     </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/mvc </span><br><span class="line">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span><br><span class="line">        http://www.springframework.org/schema/context </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">        http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">context:component-scan</span> <span class="attribute">base-package</span>=<span class="value">"com.crunchify.controller"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="title">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="title">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">cache:annotation-driven</span> <span class="attribute">cache-manager</span>=<span class="value">"ehcacheCacheManager"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">cache:annotation-driven</span> <span class="attribute">key-generator</span>=<span class="value">"enhancedDefaultKeyGenerator"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"enhancedDefaultKeyGenerator"</span></span><br><span class="line">		<span class="attribute">class</span>=<span class="value">"com.crunchify.controller.EnhancedDefaultKeyGenerator"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ehcacheManager"</span></span><br><span class="line">		<span class="attribute">class</span>=<span class="value">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"configLocation"</span> <span class="attribute">value</span>=<span class="value">"classpath:main/resource/ehcache.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ehcacheCacheManager"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.cache.ehcache.EhCacheCacheManager"</span> </span><br><span class="line">		<span class="attribute">p:cacheManager-ref</span>=<span class="value">"ehcacheManager"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"viewResolver"</span></span><br><span class="line">		<span class="attribute">class</span>=<span class="value">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"viewClass"</span></span><br><span class="line">			<span class="attribute">value</span>=<span class="value">"org.springframework.web.servlet.view.JstlView"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"prefix"</span> <span class="attribute">value</span>=<span class="value">"/WEB-INF/jsp/"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"suffix"</span> <span class="attribute">value</span>=<span class="value">".jsp"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中添加了对应cache的一些支持，代码：<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">xmlns:cache="http://www.springframework.org/schema/cache" </span><br><span class="line">xmlns:p="http://www.springframework.org/schema/p"</span><br><span class="line">xsi:schemaLocation="</span><br><span class="line">       </span><br><span class="line">        http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">cache:annotation-driven</span> <span class="attribute">cache-manager</span>=<span class="value">"ehcacheCacheManager"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">cache:annotation-driven</span> <span class="attribute">key-generator</span>=<span class="value">"enhancedDefaultKeyGenerator"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"enhancedDefaultKeyGenerator"</span></span><br><span class="line">		<span class="attribute">class</span>=<span class="value">"com.crunchify.controller.EnhancedDefaultKeyGenerator"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ehcacheManager"</span></span><br><span class="line">		<span class="attribute">class</span>=<span class="value">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">property</span> <span class="attribute">name</span>=<span class="value">"configLocation"</span> <span class="attribute">value</span>=<span class="value">"classpath:main/resource/ehcache.xml"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ehcacheCacheManager"</span> <span class="attribute">class</span>=<span class="value">"org.springframework.cache.ehcache.EhCacheCacheManager"</span> </span><br><span class="line">		<span class="attribute">p:cacheManager-ref</span>=<span class="value">"ehcacheManager"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里定义的key的结构为：<code>类名:方法名：(参数值以|分割)</code>, 示例如下：</p>
<p>实现代码：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Cacheable(value = &#34;cache1&#34;)&#10;public Movie findByDirector(String name) &#123;&#10;&#9;//...&#10;&#9;return null;&#10;&#125;&#10;&#10;obj.findByDirector(&#34;dummy&#34;)</span><br></pre></td></tr></table></figure></p>
<p>这是对应的key为：<br><code>com.demo.test.MovieDaoImpl:findByDirector:|dummy</code></p>
<h2 id="u67E5_u770B_u5F53_u524D_u7F13_u5B58_u91CC_u7684_u5185_u5BB9_uFF1A"><a href="#u67E5_u770B_u5F53_u524D_u7F13_u5B58_u91CC_u7684_u5185_u5BB9_uFF1A" class="headerlink" title="查看当前缓存里的内容："></a>查看当前缓存里的内容：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.sf.ehcache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> net.sf.ehcache.Ehcache;</span><br><span class="line"><span class="keyword">import</span> net.sf.ehcache.Element;</span><br><span class="line"><span class="keyword">import</span> net.sf.ehcache.statistics.StatisticsGateway;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">String[] cacheNames = CacheManager.getInstance().getCacheNames();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (String cacheName : cacheNames) &#123;</span><br><span class="line">	System.out.println(<span class="string">"## CacheName: "</span> + cacheName);</span><br><span class="line">	Ehcache cache = CacheManager.getInstance().getCache(cacheName);</span><br><span class="line">	System.out.println(<span class="string">"cache records: "</span> + cache.getSize());</span><br><span class="line">	StatisticsGateway st = cache.getStatistics();</span><br><span class="line">	System.out.println(<span class="string">"heap size: "</span> + st.getLocalHeapSizeInBytes() + <span class="string">" bytes"</span>);</span><br><span class="line">	System.out.println(<span class="string">"disk size: "</span> + st.getLocalDiskSizeInBytes() + <span class="string">" bytes"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Object key : cache.getKeys()) &#123;</span><br><span class="line">		Element element = cache.get(key);</span><br><span class="line"></span><br><span class="line">		System.out.println(String.format(<span class="string">"- key: %s, value: %s, hit: %d, created: %d, expiration: %d"</span>, key,</span><br><span class="line">				element.getObjectValue(), element.getHitCount(), element.getCreationTime(),</span><br><span class="line">				element.getExpirationTime()));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，对应ehcache里的内容就被打印出来了，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## CacheName: cache2&#10;cache records: 0&#10;heap size: 0 bytes&#10;disk size: 0 bytes&#10;## CacheName: cache1&#10;heap size: 760 bytes&#10;disk size: 803 bytes&#10;- key: com.demo.test.MovieDaoImpl:findByDirector:|dummy2, value: com.demo.test.Movie@71ba6d4e, hit: 1, created: 1452027528985, expiration: 1452027829081&#10;- key: com.demo.test.MovieDaoImpl:findByDirector:|dummy, value: com.demo.test.Movie@55a147cc, hit: 2, created: 1452027526982, expiration: 1452027829081</span><br></pre></td></tr></table></figure>
<h2 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h2><h3 id="u5BF9_u5E94_u7684ehcache-xml_u6587_u4EF6"><a href="#u5BF9_u5E94_u7684ehcache-xml_u6587_u4EF6" class="headerlink" title="对应的ehcache.xml文件"></a>对应的ehcache.xml文件</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ehcache</span> <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">	<span class="attribute">xsi:noNamespaceSchemaLocation</span>=<span class="value">"ehcache.xsd"</span> <span class="attribute">updateCheck</span>=<span class="value">"false"</span></span><br><span class="line">	<span class="attribute">monitoring</span>=<span class="value">"autodetect"</span> <span class="attribute">dynamicConfig</span>=<span class="value">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">diskStore</span> <span class="attribute">path</span>=<span class="value">"java.io.tmpdir"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">cache</span> <span class="attribute">name</span>=<span class="value">"cache1"</span> <span class="attribute">maxEntriesLocalHeap</span>=<span class="value">"10000"</span></span><br><span class="line">		<span class="attribute">maxEntriesLocalDisk</span>=<span class="value">"1000"</span> <span class="attribute">eternal</span>=<span class="value">"false"</span> <span class="attribute">diskSpoolBufferSizeMB</span>=<span class="value">"20"</span></span><br><span class="line">		<span class="attribute">timeToIdleSeconds</span>=<span class="value">"300"</span> <span class="attribute">timeToLiveSeconds</span>=<span class="value">"600"</span></span><br><span class="line">		<span class="attribute">memoryStoreEvictionPolicy</span>=<span class="value">"LFU"</span> <span class="attribute">transactionalMode</span>=<span class="value">"off"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">persistence</span> <span class="attribute">strategy</span>=<span class="value">"localTempSwap"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">cache</span> <span class="attribute">name</span>=<span class="value">"cache2"</span> <span class="attribute">maxEntriesLocalHeap</span>=<span class="value">"10000"</span></span><br><span class="line">		<span class="attribute">maxEntriesLocalDisk</span>=<span class="value">"1000"</span> <span class="attribute">eternal</span>=<span class="value">"false"</span> <span class="attribute">diskSpoolBufferSizeMB</span>=<span class="value">"20"</span></span><br><span class="line">		<span class="attribute">timeToIdleSeconds</span>=<span class="value">"300"</span> <span class="attribute">timeToLiveSeconds</span>=<span class="value">"600"</span></span><br><span class="line">		<span class="attribute">memoryStoreEvictionPolicy</span>=<span class="value">"LFU"</span> <span class="attribute">transactionalMode</span>=<span class="value">"off"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">persistence</span> <span class="attribute">strategy</span>=<span class="value">"localTempSwap"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="u53EF_u4EE5_u501F_u9274_u7684_u4E00_u4E9BKeyGenerator"><a href="#u53EF_u4EE5_u501F_u9274_u7684_u4E00_u4E9BKeyGenerator" class="headerlink" title="可以借鉴的一些KeyGenerator"></a>可以借鉴的一些KeyGenerator</h3><ul>
<li>具体配置：<a href="https://github.com/agentgt/ehcache-spring-annotations/blob/master/core/src/test/resources/performanceTestContext.xml" target="_blank" rel="external">https://github.com/agentgt/ehcache-spring-annotations/blob/master/core/src/test/resources/performanceTestContext.xml</a></li>
<li>代码实现: <a href="https://github.com/agentgt/ehcache-spring-annotations/tree/master/core/src/main/java/com/googlecode/ehcache/annotations/key" target="_blank" rel="external">https://github.com/agentgt/ehcache-spring-annotations/tree/master/core/src/main/java/com/googlecode/ehcache/annotations/key</a></li>
</ul>
<h3 id="u53C2_u8003_u6587_u7AE0"><a href="#u53C2_u8003_u6587_u7AE0" class="headerlink" title="参考文章"></a>参考文章</h3><ul>
<li><a href="http://www.codingpedia.org/ama/spring-caching-with-ehcache/" target="_blank" rel="external">http://www.codingpedia.org/ama/spring-caching-with-ehcache/</a></li>
</ul>
</div><div class="tags"><a href="/tags/ehcache/">ehcache</a><a href="/tags/java/">java</a><a href="/tags/spring/">spring</a></div><div class="post-nav"><a href="/2016/01/06/use-redis-as-mybatis-cache-storage/" class="pre"><i class="icon-previous">use redis as mybatis cache storage</i></a><a href="/2016/01/04/Spring-Cacheable-annotation-with-google-guava-and-ehcache/" class="next">Spring @Cacheable annotation with google guava and ehcache<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'junhuih';
var disqus_identifier = '2016/01/05/custom-keygenerator-in-ehcache-with-spring/';
var disqus_title = 'custom keygenerator in ehcache with spring';
var disqus_url = 'https://junhuih.com/2016/01/05/custom-keygenerator-in-ehcache-with-spring/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//junhuih.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="https://junhuih.com"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/net/">.net</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/security/" style="font-size: 15px;">security</a> <a href="/tags/varnish/" style="font-size: 15px;">varnish</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/httpclient/" style="font-size: 15px;">httpclient</a> <a href="/tags/bigdata/" style="font-size: 15px;">bigdata</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/dotnet/" style="font-size: 15px;">dotnet</a> <a href="/tags/mybatis/" style="font-size: 15px;">mybatis</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/magento/" style="font-size: 15px;">magento</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/https/" style="font-size: 15px;">https</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/sqoop/" style="font-size: 15px;">sqoop</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/others/" style="font-size: 15px;">others</a> <a href="/tags/net/" style="font-size: 15px;">.net</a> <a href="/tags/asp-net/" style="font-size: 15px;">asp.net</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/ehcache/" style="font-size: 15px;">ehcache</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/cache/" style="font-size: 15px;">cache</a> <a href="/tags/guava/" style="font-size: 15px;">guava</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/27/start-to-use-redis-cluster/">初步使用redis cluster集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/26/use-redis-bit-operation-to-do-realtime-metrics/">用redis的bit来快速实现用户信息统计</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/15/turn-website-from-http-to-https/">关于网站从http转到https</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/14/use-node-js-to-call-magento-api/">用node.js调用magento api</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/08/anti-xss-in-java-use-coverity-security-library/">anti-xss in java use coverity security library</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/06/use-redis-as-mybatis-cache-storage/">use redis as mybatis cache storage</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/05/custom-keygenerator-in-ehcache-with-spring/">custom keygenerator in ehcache with spring</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/04/Spring-Cacheable-annotation-with-google-guava-and-ehcache/">Spring @Cacheable annotation with google guava and ehcache</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/04/use-spring-resttemplate-and-apache-httpclient/">use spring resttemplate and apache httpclient</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/31/deploy-hexo-blog-to-github/">Deploy hexo blog to github</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Junhuih Notes.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?8e4e20868ca997be7a75b457bd0ae31b";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></div></body></html>